<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <title>D3 - exercice 3</title>
        <script type="text/javascript" src="static/d3.v7.min.js"></script>
		<link rel="stylesheet" href="static/bootstrap.min.css" >

		<style>
			body {margin: 4em;}
			
			g.barre:hover {stroke: grey; stroke-width: 2; stroke-dasharray: 4; transition: 400ms}
			
			.ligneIndicateur{ stroke: grey; opacity: 0; strocke-width: 1; stroke-dasharray: 4; transition: 400ms}
			.precip {opacity: 0; text-anchor: end; transition: 400ms}
			
			g.barre:hover .precip{stroke: none; opacity: 1}
			g.barre:hover .ligneIndicateur{opacity: 1}
		</style>
    </head>
    <body>
		<svg style="border: 2px solid grey" width="640" height="400"></svg>
        <script type="text/javascript">
        var stations = [{"nom":"Brest","mois":[{"temp":6.9,"precip":143.8},{"temp":6.8,"precip":111.7},{"temp":8.4,"precip":95.8},{"temp":9.6,"precip":92.1},{"temp":12.6,"precip":79},{"temp":15,"precip":59.8},{"temp":16.9,"precip":66.8},{"temp":17,"precip":66.8},{"temp":15.4,"precip":83.3},{"temp":12.7,"precip":129},{"temp":9.5,"precip":134.1},{"temp":7.3,"precip":147.8}]},{"nom":"Pontarlier","mois":[{"temp":-0.2,"precip":117.4},{"temp":0.6,"precip":106.6},{"temp":3.7,"precip":113.9},{"temp":6.9,"precip":113.4},{"temp":11.3,"precip":147.2},{"temp":14.5,"precip":131.2},{"temp":17,"precip":119.9},{"temp":16.6,"precip":127.9},{"temp":13.1,"precip":127.3},{"temp":9.5,"precip":131.9},{"temp":3.9,"precip":127.6},{"temp":1,"precip":139}]},{"nom":"nice","mois":[{"temp":9.2,"precip":69},{"temp":9.6,"precip":44.7},{"temp":11.6,"precip":38.7},{"temp":13.6,"precip":69.3},{"temp":17.4,"precip":44.6},{"temp":20.9,"precip":34.3},{"temp":23.8,"precip":12.1},{"temp":24.1,"precip":17.8},{"temp":21,"precip":73.1},{"temp":17.4,"precip":132.8},{"temp":12.9,"precip":103.9},{"temp":10,"precip":92.7}]},{"nom":"Melun","mois":[{"temp":3.7,"precip":55.1},{"temp":4.4,"precip":47.6},{"temp":7.6,"precip":51},{"temp":10.2,"precip":53.7},{"temp":14.1,"precip":64.6},{"temp":17,"precip":53.9},{"temp":19.3,"precip":61.3},{"temp":19.1,"precip":53.4},{"temp":15.8,"precip":56.1},{"temp":12,"precip":63.6},{"temp":7.1,"precip":55.2},{"temp":4.3,"precip":61.4}]}];
		
		
		
		
		/*var echelleAbscisse = d3.scaleLinear()
										.domain([0, 12])
										.range([80, 560]);
		
		/// calcul de la précipitation la plus importante
		var maxPrecip = d3.max(station.mois, function (donnees, indice) {
			return donnees.precip;
		});
		
		var medianePrecip = d3.median(station.mois, function (donnees, indice) {
			return donnees.precip;
		});		
		
		var echellePrecipitation = d3.scaleLinear()
										.domain([0, maxPrecip])
										.range([0, 300])
										.nice([10])

		var echelleAxePrecipitation = d3.scaleLinear()
										.domain([0, maxPrecip])
										.range([300, 0])
										.nice([10])
										

										
		var axeOrdonnees = d3.axisLeft()
			.scale(echelleAxePrecipitation)
								//.tickSize(-520)
								
		/// dessiner axe ordonnée
		d3.select("svg")
			.append("g")
				.classed("axePrecip", true)
				.style("opacity", 0)
				.attr("transform", "translate(60, 60)")
				.call(axeOrdonnees)
				.transition()
					.delay(10)
					.duration(1000)
					.style("opacity", 1)

		var echelleCouleur = d3.scaleLinear()
									.domain([0, maxPrecip])
									.range(["white", "darkblue"])
		
		var _largeurMois = echelleAbscisse(1) - echelleAbscisse(0) - 2;
		
		// dessiner les bandes
		var gBarres = d3.select("svg")
			.selectAll("g.barre")
			.data(station.mois)
			.enter()
			.append("g")
				.classed("barre", true);
			
		gBarres.append("rect")
				// largeur
				.attr("width", _largeurMois)
				.attr("height",echellePrecipitation(medianePrecip))
				// position horizontale
				.attr("x", function (donnee, indice) {
					return echelleAbscisse(indice);
				})
				.attr("y", 360 - echellePrecipitation(medianePrecip))

				// couleur de fond
				.style("fill", function (donnee, i) {
					return echelleCouleur(donnee.precip);
				})
				.transition()
					.delay(10)
					.duration(1000)
						.attr("height", function (donnee, indice) {
							return echellePrecipitation(donnee.precip);
						})
						.attr("y", function (donnee, indice) {
							return 360 - echellePrecipitation(donnee.precip);
						})
		
		// textes
		gBarres.append("text")
				.classed("precip", true)
				// utiliser le centre comme référence pour le placement horizontal
				.style("text-anchor", "middle")	
				// utiliser le bas comme référence pour le placement vertical 
				.style("dominant-baseline", "text-top ")
				// contenu
				.text(function (donnee, indice) {
					return donnee.precip;
				})
				// position horizontal
				.attr("x", function (donnee, indice) {
					return echelleAbscisse(0) - 55 ;
				})
				.attr("y", function (donnee, indice) {
					return 360 - echellePrecipitation(donnee.precip) + 5 ;
				})
					
		gBarres.append("line")
				.classed("ligneIndicateur", true)
				.attr("x1", function (donnee, indice) {
					return echelleAbscisse(0) -20 ;
				})
				.attr("y1", function (donnee, indice) {
					return 360 - echellePrecipitation(donnee.precip) ;
				})	
				.attr("x2", function (donnee, indice) {
					return echelleAbscisse(indice);
				})
				.attr("y2", function (donnee, indice) {
					return 360 - echellePrecipitation(donnee.precip)  ;
				})		
		
				
		let maxTemp = d3.max(station.mois, function (donnee, indice) {
			return donnee.temp;
		})
		
		let minTemp = d3.min(station.mois, function (donnee, indice) {
			return donnee.temp;
		})		
		
		
		var echelleTemp = d3.scaleLinear()
				.domain([0, maxTemp])
				.range([360, 60])
				.nice([10])		

		var ligneTempInitiale = d3.line()
			.x(function(donnee, indice) { 
					return echelleAbscisse(indice) + _largeurMois/2
				})
			.y(echelleTemp(minTemp))
			.curve(d3.curveBasis)

		var ligneTemp = d3.line()
			.x(function(donnee, indice) { 
					return echelleAbscisse(indice) + _largeurMois/2
				})
			.y(function(donnee, indice) { 
				return echelleTemp(donnee.temp) })
			.curve(d3.curveBasis)

			
		var axeTemp = d3.axisRight()
				.scale(echelleTemp)
				.ticks(6, ".2")
				
				
		d3.select("svg")
			.append("g")
				.call(axeTemp)
				.style("opacity", 0)	
				.classed("axeTemp", true)
				.attr("transform", "translate(580, 0)")			
				.transition()
					.delay(10)
					.duration(1000)
					.style("opacity", 1)	
			
		d3.select("svg")
			.append("path")
				.datum(station.mois)
				.attr("d", function (d) {return ligneTempInitiale(d)})
				.attr("fill", "none")
				.attr("stroke", "#800000")
				.attr("stroke-width", 3)
				.transition()
					.delay(100)
					.duration(1000)
						.attr("d", function (d) {return ligneTemp(d)})
				
				*/
		</script>
    </body>
</html>