<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <title>D3 - exercice 2 - correction</title>
        <script type="text/javascript" src="static/d3.v7.min.js"></script>
		<link rel="stylesheet" href="static/bootstrap.min.css" >

		<style>
			body {margin: 4em;}
		</style>
    </head>
    <body>
		<svg style="border: 2px solid grey" width="640" height="400"></svg>
        <script type="text/javascript">
        var station = {"nom":"Brest","mois":[{"precip":143.8},{"precip":111.7},{"precip":95.8},{"precip":92.1},{"precip":79},{"precip":59.8},{"precip":66.8},{"precip":66.8},{"precip":83.3},{"precip":129},{"precip":134.1},{"precip":147.8}]};

		var echelleAbscisse = d3.scaleLinear()
										.domain([0, 12])
										.range([80, 560]);
		
		/// calcul de la précipitation la plus importante
		var maxPrecip = d3.max(station.mois, function (donnees, indice) {
			return donnees.precip;
		});
		
		var echellePrecipitation = d3.scaleLinear()
										.domain([0, maxPrecip])
										.range([0, 300])

		var echelleAxePrecipitation = d3.scaleLinear()
										.domain([0, maxPrecip])
										.range([300, 0])
										
		var axeOrdonnees = d3.axisLeft()
								.scale(echelleAxePrecipitation)
								.tickSize(-520)
								
		/// dessiner axe ordonnée
		d3.select("svg")
			.append("g")
				.classed("axeOrdonnees", true)
				.attr("transform", "translate(60, 60)")
					.call(axeOrdonnees)
					.selectAll(".tick")
						.attr("stroke-opacity", 0.3)
						.attr("stroke-dasharray", "2,2")
		
		// supprimer le cadre créé par axe ordonnée
		d3.select("svg g.axeOrdonnees path")
			.attr("stroke", "none")
			
		
		var echelleCouleur = d3.scaleLinear()
									.domain([0, maxPrecip])
									.range(["white", "darkblue"])
		
		var _largeurMois = echelleAbscisse(1) - echelleAbscisse(0) - 2;
		
		// dessiner les bandes
		d3.select("svg")
			.selectAll("rect")
			.data(station.mois)
			.enter()
			.append("rect")
				// largeur
				.attr("width", _largeurMois)
				// hauteur
				.attr("height", function (donnee, indice) {
					return echellePrecipitation(donnee.precip);
				})
				// position horizontale
				.attr("x", function (donnee, indice) {
					return echelleAbscisse(indice);
				})
				// position verticale
				.attr("y", function (donnee, indice) {
					return 360 - echellePrecipitation(donnee.precip);
				})
				// couleur de fond
				.style("fill", function (donnee, i) {
					return echelleCouleur(donnee.precip);
				})
		
		// textes
		d3.select("svg")
			.selectAll("text.precip")
			.data(station.mois)
			.enter()
			.append("text")
				.classed("precip", true)
				// utiliser le centre comme référence pour le placement horizontal
				.style("text-anchor", "middle")	
				// utiliser le bas comme référence pour le placement vertical 
				.style("dominant-baseline", "text-top ")
				// contenu
				.text(function (donnee, indice) {
					return donnee.precip;
				})
				// position horizontal
				.attr("x", function (donnee, indice) {
					return echelleAbscisse(indice) + (_largeurMois / 2);
				})
				.attr("y", function (donnee, indice) {
					return 360 - echellePrecipitation(donnee.precip) - 5 ;
				})
		</script>
    </body>
</html>